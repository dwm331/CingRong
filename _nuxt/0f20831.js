(window.webpackJsonp=window.webpackJsonp||[]).push([[8,3],{303:function(t,e,r){t.exports=r.p+"img/android-chrome-192x192.8fa749d.png"},304:function(t,e,r){"use strict";r.r(e);var o={props:["showNav"]},n=r(70),component=Object(n.a)(o,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"header"},[o("img",{staticClass:"logo",attrs:{src:r(303),alt:""}}),t._v(" "),t._m(0),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.showNav,expression:"showNav"}]},[o("b-navbar",[o("b-navbar-nav",[o("b-nav-item",{attrs:{href:"/"}},[t._v("首頁")]),t._v(" "),o("b-nav-item",{attrs:{href:"/admin/mCat"}},[t._v("分類管理")]),t._v(" "),o("b-nav-item",{attrs:{href:"/admin/mPro"}},[t._v("產品管理")])],1)],1)],1)])}),[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"header_title"},[r("p",{staticClass:"title"},[t._v("慶榮五金行")]),r("p",{staticClass:"subtitle"},[t._v("Cing Rong Hardware")])])}],!1,null,null,null);e.default=component.exports},307:function(t,e,r){var content=r(315);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(104).default)("7cfa0ff3",content,!0,{sourceMap:!1})},314:function(t,e,r){"use strict";r(307)},315:function(t,e,r){var o=r(103)(!1);o.push([t.i,".header{padding:0 10px;display:flex;justify-content:flex-start;background-color:#fff26b;flex-wrap:wrap;width:100%;position:fixed;z-index:999}.header .logo{width:58px;height:58px}.header .header_title{padding:0 34px}.header .header_title .title{margin:-4px 0;font-size:35px;font-weight:700}.header .header_title .subtitle{text-align:right;color:grey;margin:-12px 0 0;font-size:14px;font-weight:400}@media (max-width:428px){.header .logo{width:45px;height:45px}.header .header_title{text-align:center}.header .header_title .title{font-size:26px;font-weight:500}.header .header_title .subtitle{margin:-8px 0 0;font-size:10px}}.management_section{padding:100px 0}",""]),t.exports=o},324:function(t,e,r){"use strict";r.r(e);var o=r(0),n=r(46),c=r(29),l=(r(83),r(12),r(127),r(22),r(6),r(162),r(15),r(163),r(17),r(5),r(3),r(2),r(7),r(4),r(8),r(102)),f=r.n(l),m=r(78),d=r(161);function h(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function y(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?h(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):h(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var v={data:function(){return{categories:[],tempCategoryName:"",tempSubCategoryName:[],categoryKey:"",options:[],form:{productKey:null,category:null,subCategory:null,no:"",name:"",src:"",info:""},search:{category:null,subCategory:null},fields:[{key:"categoryName",label:"產品分類",sortable:!0,width:"100"},{key:"subCategoryName",label:"子分類",sortable:!0},{key:"img",label:"圖片",sortable:!1},{key:"no",label:"產品編號",sortable:!0},{key:"name",label:"產品名稱",sortable:!0},{key:"info",label:"說明",sortable:!0},{key:"show_details",label:"操作",sortable:!1}],allProduct:[],imgurConfig:{albumHash:"W3v7chF",accessToken:null,account_username:null,expires_in:null,clientID:""},uploadfile:null}},watch:{"form.category":function(t){null===this.form.productKey&&(this.form.subCategory=null)},"search.category":function(t){this.search.subCategory=null,this.getProductByCategoryKey(t,null)},"search.subCategory":function(t){this.getProductByCategoryKey(null,t)}},methods:{handleItemImg:function(t){this.uploadfile=t.target.files[0];var e=t.target.files[0];this.createBase64Img(e)},createBase64Img:function(t){var e=this,r=new FileReader;r.readAsDataURL(t),r.onload=function(){e.form.src=r.result}},onSubmit:function(t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.preventDefault(),null==e.uploadfile){r.next=16;break}if(null!=e.imgurConfig.accessToken){r.next=5;break}return alert("請先登錄imgur"),r.abrupt("return");case 5:return r.next=7,e.uploadimage(e.uploadfile);case 7:if(o=r.sent,"object"!==Object(n.a)(o)||!o.hasOwnProperty("data")){r.next=14;break}if(o.success){r.next=12;break}return alert("上傳發生錯誤"+o.data.error),r.abrupt("return");case 12:r.next=16;break;case 14:return alert("上傳發生錯誤"+o),r.abrupt("return");case 16:Boolean(e.form.productKey)?e.editProduct(e.form):e.addProduct(e.form),e.onReset(t);case 18:case"end":return r.stop()}}),r)})))()},onReset:function(t){t.preventDefault(),this.form={productKey:null,category:null,subCategory:null,no:"",name:"",src:"",info:""}},addProduct:function(t){var e=this;Object(d.e)(Object(d.g)(m.a,"Product"),{category:t.category,subCategory:t.subCategory,name:t.name,src:t.src,info:t.info}).then((function(data){console.log("Data saved successfully!",data),e.form={productKey:null,category:null,subCategory:null,no:"",name:"",src:"",info:""},e.getProduct()})).catch((function(t){console.log("Data saved error",t),e.delimage(e.from.scr)}))},deleteProduct:function(t){var e=this;t.item&&t.item.productKey&&Object(d.h)(Object(d.g)(m.a,"Product/".concat(t.item.productKey))).then((function(){console.log("Data remove successfully!"),e.getProduct(),e.delimage(e.from.scr)})).catch((function(t){console.log("Data remove error",t)}))},getProductByRow:function(t){t.item&&t.item.productKey&&(this.form={productKey:t.item.productKey,category:t.item.category,subCategory:t.item.subCategory||null,no:t.item.no,name:t.item.name,src:t.item.src,info:t.item.info})},getProductByCategoryKey:function(t,e){var r=this;return Object(c.a)(regeneratorRuntime.mark((function o(){var n;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=Object(d.f)(Object(d.g)(m.a,"Product")),Boolean(t)&&(n=Object(d.f)(Object(d.g)(m.a,"Product"),Object(d.d)("category"),Object(d.a)(t))),Boolean(e)&&(n=Object(d.f)(Object(d.g)(m.a,"Product"),Object(d.d)("subCategory"),Object(d.a)(e))),r.allProduct=[],Object(d.c)(n,(function(t){var e=t.val();if(e){var o=JSON.stringify(e);r.allProduct=JSON.parse(o)}else r.allProduct=[]}),{onlyOnce:!0});case 5:case"end":return o.stop()}}),o)})))()},editProduct:function(t){var e=this,data={category:t.category,subCategory:t.subCategory||"",no:t.no,name:t.name,src:t.src,info:t.info};Object(d.i)(Object(d.g)(m.a,"Product/".concat(t.productKey)),data).then((function(){console.log("Data update successfully!"),e.getProduct()})).catch((function(t){console.log("Data update error",t),e.delimage(e.from.scr)}))},getCategoryName:function(t){if(Object.keys(this.categories).length>0)for(var p in this.categories){var e=this.categories[p];if(Object.keys(e).length>0)for(var r in e)if(r==t)return e[r].name}else console.log("尚未讀取categories資料")},getUrlLoginInfo:function(){var t=window.location.href,e=t.match(/access_token=([^&]+)/),r=t.match(/expires_in=([^&]+)/),o=t.match(/account_username=([^&]+)/);if(e&&r&&o){var n=e[1],c=r[1],l=o[1];this.imgurConfig.accessToken=n,this.imgurConfig.account_username=l,this.imgurConfig.expires_in=c,localStorage.setItem("imgurConfig",JSON.stringify(this.imgurConfig))}else console.log("沒有imgur登入資訊，請先登入才能上傳圖片")},uploadimage:function(t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function r(){var o,n,c,l,m,d,h,y,v,_;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n={Authorization:"Bearer "+e.imgurConfig.accessToken,"Content-Type":"application/json"},(c=new FormData).append("image",t),l="No."+(e.form.no?" "+e.form.no:"")+"-"+e.form.name,m=e.categories[e.form.category]||{},d=(null===(o=m.subCategory)||void 0===o?void 0:o[e.form.subCategory])||{},h=m.name||"",y=d.name||"",v="".concat(e.form.info," #").concat(h," #").concat(y),_={album:e.imgurConfig.albumHash,title:l,description:v},r.next=12,f.a.post("https://api.imgur.com/3/image",c,{headers:n,params:_}).then((function(t){return console.log("響應數據:",t.data),t.data.success?(e.form.src=t.data.data.link,console.log("uploadimage",e.form)):alert("上傳imgur發生問題",t.data.data.error),t.data})).catch((function(t){return console.error("請求失敗:",t),t}));case 12:return r.abrupt("return",r.sent);case 13:case"end":return r.stop()}}),r)})))()},delimage:function(t){var e={Authorization:"Bearer "+this.imgurConfig.accessToken,"Content-Type":"application/json"},r=this.getFileNameFromUrl(url);f.a.delete("https://api.imgur.com/3/image/"+r,null,{headers:e}).then((function(t){console.log("響應數據:",t.data),t.data.success||alert("刪除imgur發生問題",t.data.data.error)})).catch((function(t){console.error("請求失敗:",t)}))},getFileNameFromUrl:function(t){var e=t.match(/\/([^/]+)\.jpg$/i);return e?(console.log("文件名:",filename),e[1]):(console.log("未找到文件名"),"")},getSubCategoryName:function(t,e){},getProduct:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(d.g)(m.a,"Product"),t.allProduct=[],Object(d.c)(r,(function(e){var r=e.val();if(r){var o=JSON.stringify(r);t.allProduct=JSON.parse(o)}else t.allProduct=[]}),{onlyOnce:!0});case 3:case"end":return e.stop()}}),e)})))()},getCategories:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(d.c)(Object(d.g)(m.a,"Category"),(function(e){var r=e.val();t.categories=r||[]}),{onlyOnce:!0});case 1:case"end":return e.stop()}}),e)})))()},getAppSetting:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object(d.g)(m.a,"AppSetting"),Object(d.c)(r,(function(e){var r=e.val();console.log(r),t.imgurConfig.clientID=r?r.IMGUR.CLIENTID:"",localStorage.setItem("imgurConfig",JSON.stringify(t.imgurConfig)),console.log("getAppSetting",t.imgurConfig)}),{onlyOnce:!0});case 2:case"end":return e.stop()}}),e)})))()}},computed:{getSubCategory:function(){return this.form.category?this.categories[this.form.category].subCategory||{}:this.search.category?this.categories[this.search.category].subCategory||{}:[]},getProducts:function(){var t=this,e=this;return Object.keys(this.allProduct).map((function(r){var o=t.allProduct[r],n=e.categories[o.category]?e.categories[o.category].name:"",c=e.categories[o.category]&&e.categories[o.category].subCategory&&e.categories[o.category].subCategory[o.subCategory]?e.categories[o.category].subCategory[o.subCategory].name:"";return y(y({},o),{},{productKey:r,categoryName:n,subCategoryName:c})}))}},mounted:function(){if(this.$store.state.user){this.getProduct(),this.getCategories(),this.getAppSetting();var t=JSON.parse(localStorage.getItem("imgurConfig"));null!=t&&null!=t.accessToken?this.imgurConfig=t:(this.getUrlLoginInfo(),(null==this.imgurConfig.accessToken||null!=this.imgurConfig.accessToken&&""==this.imgurConfig.accessToken)&&localStorage.setItem("imgurConfig",JSON.stringify(this.imgurConfig)))}else this.$router.push("/admin")}},_=(r(314),r(70)),component=Object(_.a)(v,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"wrapper"},[r("Header",{attrs:{showNav:"true"}}),t._v(" "),r("b-container",{staticClass:"management_section"},[r("h1",[t._v("產品管理")]),t._v(" "),r("b-row",[r("b-col",{attrs:{cols:"8"}},[r("b-form",[r("b-form-group",{staticClass:"text-primary font-weight-bold",attrs:{id:"search-group-3",label:"查詢產品分類:","label-for":"product_search_cat"}},[r("b-form-select",{staticClass:"col-4",attrs:{id:"product_search_cat"},model:{value:t.search.category,callback:function(e){t.$set(t.search,"category",e)},expression:"search.category"}},[r("b-form-select-option",{attrs:{value:null}},[t._v("請選擇產品分類")]),t._v(" "),t._l(t.categories,(function(e,o,n){return r("b-form-select-option",{key:n,attrs:{value:o}},[t._v(t._s(e.name))])}))],2),t._v(" "),r("b-form-select",{staticClass:"col-4",attrs:{id:"product_search_sub_cat"},model:{value:t.search.subCategory,callback:function(e){t.$set(t.search,"subCategory",e)},expression:"search.subCategory"}},[r("b-form-select-option",{attrs:{value:null}},[t._v("請選擇產品子分類")]),t._v(" "),t._l(t.getSubCategory,(function(e,o,n){return r("b-form-select-option",{key:n,attrs:{value:o}},[t._v(t._s(e.name))])}))],2),t._v(" "),r("b-button",{attrs:{variant:"secondary"},on:{click:function(e){return t.getProductByCategoryKey()}}},[t._v("顯示所有產品")]),t._v(" "),r("span",{staticClass:"text-secondary"},[t._v("共 "+t._s(Object.keys(t.allProduct).length)+" 筆資料")])],1)],1),t._v(" "),r("b-table",{attrs:{striped:"",hover:"",fields:t.fields,items:t.getProducts},scopedSlots:t._u([{key:"table-colgroup",fn:function(e){return t._l(e.fields,(function(t){return r("col",{key:t.key,style:{width:"info"===t.key?"300px":"120px"}})}))}},{key:"cell(img)",fn:function(t){return[r("img",{staticClass:"img-fluid",attrs:{id:"itemImg",src:t.item.src,alt:"圖片預覽",width:"200"}})]}},{key:"cell(show_details)",fn:function(e){return[r("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"success"},on:{click:function(r){return t.getProductByRow(e)}}},[t._v("修改")]),t._v(" "),r("b-button",{staticClass:"mr-2",attrs:{size:"sm",variant:"danger"},on:{click:function(r){return t.deleteProduct(e)}}},[t._v("刪除")])]}}])})],1),t._v(" "),r("b-col",[r("div",{staticClass:"border p-3",class:{"border-primary":!t.form.productKey,"border-success":t.form.productKey}},[r("div",{staticClass:"row p-3"},[t.form.productKey?t._e():r("h4",{staticClass:"text-primary m-0"},[t._v("新增產品")]),t._v(" "),t.form.productKey?r("h4",{staticClass:"text-success m-0"},[t._v("編輯產品")]):t._e(),t._v(" "),t.form.productKey?r("b-button",{staticClass:"ml-2",attrs:{size:"sm",pill:"",variant:"outline-success",height:"30px"},on:{click:function(e){t.form.productKey=null}}},[t._v("取消")]):t._e()],1),t._v(" "),r("b-form",{on:{submit:t.onSubmit,reset:t.onReset}},[r("b-form-group",{staticClass:"text-dark font-weight-bold",attrs:{id:"input-group-0",label:"產品編號:","label-for":"product_no"}},[r("b-form-input",{attrs:{id:"product_no",required:""},model:{value:t.form.no,callback:function(e){t.$set(t.form,"no",e)},expression:"form.no"}})],1),t._v(" "),r("b-form-group",{staticClass:"text-dark font-weight-bold",attrs:{id:"input-group-1",label:"產品名稱:","label-for":"product_name"}},[r("b-form-input",{attrs:{id:"product_name",required:""},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),r("b-form-group",{staticClass:"text-dark font-weight-bold",attrs:{id:"input-group-2",label:"說明:","label-for":"product_info"}},[r("b-form-textarea",{attrs:{id:"product_info",rows:"3","max-rows":"10"},model:{value:t.form.info,callback:function(e){t.$set(t.form,"info",e)},expression:"form.info"}})],1),t._v(" "),r("b-form-group",{staticClass:"text-dark font-weight-bold",attrs:{id:"input-group-3",label:"產品分類:","label-for":"product_cat"}},[r("b-form-select",{staticClass:"mb-3",attrs:{id:"product_cat",required:""},model:{value:t.form.category,callback:function(e){t.$set(t.form,"category",e)},expression:"form.category"}},[r("b-form-select-option",{attrs:{value:null}},[t._v("請選擇產品分類")]),t._v(" "),t._l(t.categories,(function(e,o,n){return r("b-form-select-option",{key:n,attrs:{value:o}},[t._v(t._s(e.name))])}))],2),t._v(" "),r("b-form-select",{staticClass:"mb-3",attrs:{id:"product_sub_cat"},model:{value:t.form.subCategory,callback:function(e){t.$set(t.form,"subCategory",e)},expression:"form.subCategory"}},[r("b-form-select-option",{attrs:{value:null}},[t._v("請選擇產品子分類")]),t._v(" "),t._l(t.getSubCategory,(function(e,o,n){return r("b-form-select-option",{key:n,attrs:{value:o}},[t._v(t._s(e.name))])}))],2)],1),t._v(" "),r("b-form-group",{staticClass:"text-dark font-weight-bold",attrs:{id:"input-group-4",label:"產品圖片:","label-for":"product_src"}},[t.imgurConfig.account_username?r("h6",{staticClass:"text-primary m-0"},[t._v("登入帳號:"+t._s(t.imgurConfig.account_username))]):t._e(),t._v(" "),t.imgurConfig.account_username?t._e():r("a",{attrs:{href:"https://api.imgur.com/oauth2/authorize?response_type=token&client_id=e44a28476a6576b",target:"_self"}},[t._v("登入imgur")]),t._v(" "),r("b-form-file",{attrs:{id:"product_src",accept:"image/*"},on:{change:t.handleItemImg}}),t._v(" "),r("b-img",{attrs:{src:t.form.src,fluid:"",alt:"圖片預覽"}})],1),t._v(" "),r("b-form-group",[t.form.productKey?t._e():r("b-button",{attrs:{type:"submit",variant:"primary"}},[t._v("送出")]),t._v(" "),t.form.productKey?r("b-button",{attrs:{type:"submit",variant:"success"}},[t._v("修改")]):t._e(),t._v(" "),r("b-button",{attrs:{type:"reset",variant:"danger"}},[t._v("取消")])],1)],1)],1)])],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{Header:r(304).default})}}]);